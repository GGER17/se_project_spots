!function(){"use strict";const e={formSelector:".modal__form",inputSelector:".modal__input",submitButtonSelector:".modal__submit-button",inactiveButtonClass:"modal__submit-button_disabled",inputErrorClass:"modal__input_type_error",errorClass:"modal__error_visible"},t=(e,t,r)=>{e.querySelector(`#${t.id}-error`).textContent="",t.classList.remove(r.inputErrorClass)},r=(e,t,r)=>{(e=>e.some(e=>!e.validity.valid))(e)?n(t,r):(t.disabled=!1,t.classList.remove(r.inactiveButtonClass))},n=(e,t)=>{e.disabled=!0,e.classList.add(t.inactiveButtonClass)};function o(e,t,r,n){!function(e,t,r="Saving...",n="Save"){t?(e.textContent=r,e.disabled=!0):(e.textContent=n,e.disabled=!1)}(t,e,r,n)}const a=new class{constructor({baseUrl:e,headers:t}){this._baseUrl=e,this._headers=t}_handleServerResponse(e){return e.ok?e.json():Promise.reject(`Error: ${e.status}`)}getInitialCards(){return fetch(`${this._baseUrl}/cards`,{headers:this._headers}).then(this._handleServerResponse)}getAppInfo(){return Promise.all([this.getUserInfo(),this.getInitialCards()])}getUserInfo(){return fetch(`${this._baseUrl}/users/me`,{headers:this._headers}).then(this._handleServerResponse)}editUserInfo({name:e,about:t}){return fetch(`${this._baseUrl}/users/me`,{method:"PATCH",headers:this._headers,body:JSON.stringify({name:e,about:t})}).then(this._handleServerResponse)}editAvatarInfo(e){return fetch(`${this._baseUrl}/users/me/avatar`,{method:"PATCH",headers:this._headers,body:JSON.stringify({avatar:e})}).then(this._handleServerResponse)}addCard({name:e,link:t}){return fetch(`${this._baseUrl}/cards`,{method:"POST",headers:this._headers,body:JSON.stringify({name:e,link:t})}).then(this._handleServerResponse)}deleteCard(e){return fetch(`${this._baseUrl}/cards/${e}`,{method:"DELETE",headers:this._headers}).then(this._handleServerResponse)}changeLike(e,t){return fetch(`${this._baseUrl}/cards/${e}/likes`,{method:t?"DELETE":"PUT",headers:this._headers}).then(this._handleServerResponse)}}({baseUrl:"https://around-api.en.tripleten-services.com/v1",headers:{authorization:"796a3d98-ece2-444b-9ac5-30a564e35122","Content-Type":"application/json"}});let s;const c=document.querySelector(".profile__image");a.getAppInfo().then(([e,t])=>{s=e._id,x.textContent=e.name,U.textContent=e.about,c.src=e.avatar,t.forEach(e=>{const t=z(e);j.append(t)})}).catch(console.error);const i=document.querySelector(".profile__edit"),l=document.querySelector("#edit-profile-modal"),d=l.querySelector(".modal__submit-button"),u=l.querySelector(".modal__close-button"),m=document.querySelector(".profile__button"),_=document.querySelector("#new-post-modal"),h=_.querySelector(".modal__submit-button"),v=_.querySelector(".modal__close-button"),f=document.querySelector("#delete-modal"),y=f.querySelector(".modal__form"),S=y.querySelector('button[type="submit"]'),p=y.querySelector('button[type="button"]'),b=f.querySelector(".modal__close-delete"),q=document.querySelector("#avatar-modal"),L=q.querySelector("#edit-avatar-form"),E=q.querySelector(".modal__submit-button"),C=q.querySelector(".modal__close-button"),g=q.querySelector("#profile-avatar-input"),k=document.querySelector(".profile__avatar-btn"),x=document.querySelector(".profile__title"),U=document.querySelector(".profile__text"),$=l.querySelector("#profile-name-input"),A=l.querySelector("#profile-description-input"),D=_.querySelector("#card-caption-input"),I=_.querySelector("#card-image-input"),T=_.querySelector("#newpost-form"),w=l.querySelector("#edit-form"),R=document.querySelector("#preview-modal"),P=R.querySelector(".modal__close-image"),B=R.querySelector(".modal__image"),N=document.querySelector(".modal__text"),O=document.querySelector("#cards-template"),j=document.querySelector(".cards__list");let J,H;function z(e){const t=O.content.querySelector(".card").cloneNode(!0),r=t.querySelector(".card__text"),n=t.querySelector(".card__image");n.src=e.link,n.alt=e.name,r.textContent=e.name;const o=t.querySelector(".card__button");return e.isLiked&&o.classList.add("card__button_active"),o.addEventListener("click",t=>function(e,t){const r=e.target,n=r.classList.contains("card__button_active");a.changeLike(t,n).then(e=>{e.isLiked?r.classList.add("card__button_active"):r.classList.remove("card__button_active")}).catch(console.error)}(t,e._id)),t.querySelector(".card__trash-button").addEventListener("click",()=>function(e,t){J=e,H=t,M(f)}(t,e._id)),n.addEventListener("click",()=>{B.src=e.link,B.alt=e.name,N.textContent=e.name,M(R)}),t}function M(e){e.classList.add("modal_is-opened"),e.addEventListener("mousedown",G),document.addEventListener("keydown",K)}function F(e){e.classList.remove("modal_is-opened"),e.removeEventListener("mousedown",G),document.removeEventListener("keydown",K)}function G(e){e.target===e.currentTarget&&F(e.currentTarget)}function K(e){if("Escape"===e.key){const e=document.querySelector(".modal_is-opened");e&&F(e)}}var Q;w.addEventListener("submit",function(t){t.preventDefault(),o(!0,d),a.editUserInfo({name:$.value,about:A.value}).then(r=>{x.textContent=r.name,U.textContent=r.about,F(l),t.target.reset(),n(d,e)}).catch(console.error).finally(()=>{o(!1,d)})}),T.addEventListener("submit",function(t){t.preventDefault(),o(!0,h),a.addCard({name:D.value,link:I.value}).then(r=>{const o=z(r);j.prepend(o),F(_),t.target.reset(),n(h,e)}).catch(console.error).finally(()=>{o(!1,h)})}),L.addEventListener("submit",function(t){t.preventDefault(),o(!0,E),a.editAvatarInfo(g.value).then(r=>{c.src=r.avatar,F(q),t.target.reset(),n(E,e)}).catch(console.error).finally(()=>{o(!1,E)})}),y.addEventListener("submit",function(e){e.preventDefault(),o(!0,S,"Deleting...","Delete"),a.deleteCard(H).then(()=>{J.remove(),F(f)}).catch(console.error).finally(()=>{o(!1,S,"Deleting...","Delete")})}),p.addEventListener("click",function(){F(f)}),i.addEventListener("click",function(){var r,n;M(l),$.value=x.textContent,A.value=U.textContent,r=w,n=e,[$,A].forEach(e=>{t(r,e,n)})}),b.addEventListener("click",function(){F(f)}),p.addEventListener("click",function(){F(f)}),u.addEventListener("click",function(){F(l)}),P.addEventListener("click",function(){F(R)}),m.addEventListener("click",function(){M(_)}),v.addEventListener("click",function(){F(_)}),k.addEventListener("click",()=>{M(q)}),C.addEventListener("click",function(){F(q)}),Q=e,Array.from(document.querySelectorAll(Q.formSelector)).forEach(e=>{((e,n)=>{const o=Array.from(e.querySelectorAll(n.inputSelector)),a=e.querySelector(n.submitButtonSelector);r(o,a,n),o.forEach(s=>{s.addEventListener("input",function(){((e,r,n)=>{r.validity.valid?t(e,r,n):((e,t,r,n)=>{e.querySelector(`#${t.id}-error`).textContent=r,t.classList.add(n.inputErrorClass)})(e,r,r.validationMessage,n)})(e,s,n),r(o,a,n)})})})(e,Q)})}();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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LElBQ2pCQSxFQUFhaEMsaUJBQWlCLFFBQVMsV0F6Q2hCaUMsRUFBQ3RKLEVBQVFDLEVBQVNDLEtBQ3RDRCxFQUFRWSxTQUFTQyxNQUdwQmYsRUFBZUMsRUFBUUMsRUFBU0MsR0FoQmJxSixFQUFDdkosRUFBUUMsRUFBU3VKLEVBQWN0SixLQUM5QkYsRUFBT0csY0FBYyxJQUFJRixFQUFRRyxZQUN6Q0MsWUFBY21KLEVBQzdCdkosRUFBUUssVUFBVVksSUFBSWhCLEVBQU9MLGtCQVczQjBKLENBQWV2SixFQUFRQyxFQUFTQSxFQUFRd0osa0JBQW1CdkosSUF3Q3pEb0osQ0FBbUJ0SixFQUFRcUosRUFBY25KLEdBQ3pDTSxFQUFrQkMsRUFBVzJJLEVBQWVsSixFQUM5QyxNQU9BaUosQ0FBa0JELEVBQWFoSixJIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vc2VfcHJvamVjdF9zcG90cy8uL3NyYy9zY3JpcHRzL3ZhbGlkYXRpb24uanMiLCJ3ZWJwYWNrOi8vc2VfcHJvamVjdF9zcG90cy8uL3NyYy91dGlscy9oZWxwZXJzLmpzIiwid2VicGFjazovL3NlX3Byb2plY3Rfc3BvdHMvLi9zcmMvcGFnZXMvaW5kZXguanMiLCJ3ZWJwYWNrOi8vc2VfcHJvamVjdF9zcG90cy8uL3NyYy91dGlscy9BcGkuanMiXSwic291cmNlc0NvbnRlbnQiOlsiZXhwb3J0IGNvbnN0IHNldHRpbmdzID0ge1xuICBmb3JtU2VsZWN0b3I6IFwiLm1vZGFsX19mb3JtXCIsXG4gIGlucHV0U2VsZWN0b3I6IFwiLm1vZGFsX19pbnB1dFwiLFxuICBzdWJtaXRCdXR0b25TZWxlY3RvcjogXCIubW9kYWxfX3N1Ym1pdC1idXR0b25cIixcbiAgaW5hY3RpdmVCdXR0b25DbGFzczogXCJtb2RhbF9fc3VibWl0LWJ1dHRvbl9kaXNhYmxlZFwiLFxuICBpbnB1dEVycm9yQ2xhc3M6IFwibW9kYWxfX2lucHV0X3R5cGVfZXJyb3JcIixcbiAgZXJyb3JDbGFzczogXCJtb2RhbF9fZXJyb3JfdmlzaWJsZVwiLFxufTtcblxuY29uc3Qgc2hvd0lucHV0RXJyb3IgPSAoZm9ybUVsLCBpbnB1dEVsLCBlcnJvck1lc3NhZ2UsIGNvbmZpZykgPT4ge1xuICBjb25zdCBlcnJvck1lc3NhZ2VFbCA9IGZvcm1FbC5xdWVyeVNlbGVjdG9yKGAjJHtpbnB1dEVsLmlkfS1lcnJvcmApO1xuICBlcnJvck1lc3NhZ2VFbC50ZXh0Q29udGVudCA9IGVycm9yTWVzc2FnZTtcbiAgaW5wdXRFbC5jbGFzc0xpc3QuYWRkKGNvbmZpZy5pbnB1dEVycm9yQ2xhc3MpO1xufTtcblxuY29uc3QgaGlkZUlucHV0RXJyb3IgPSAoZm9ybUVsLCBpbnB1dEVsLCBjb25maWcpID0+IHtcbiAgY29uc3QgZXJyb3JNZXNzYWdlRWwgPSBmb3JtRWwucXVlcnlTZWxlY3RvcihgIyR7aW5wdXRFbC5pZH0tZXJyb3JgKTtcbiAgZXJyb3JNZXNzYWdlRWwudGV4dENvbnRlbnQgPSBcIlwiO1xuICBpbnB1dEVsLmNsYXNzTGlzdC5yZW1vdmUoY29uZmlnLmlucHV0RXJyb3JDbGFzcyk7XG59O1xuXG5jb25zdCBjaGVja0lucHV0VmFsaWRpdHkgPSAoZm9ybUVsLCBpbnB1dEVsLCBjb25maWcpID0+IHtcbiAgaWYgKCFpbnB1dEVsLnZhbGlkaXR5LnZhbGlkKSB7XG4gICAgc2hvd0lucHV0RXJyb3IoZm9ybUVsLCBpbnB1dEVsLCBpbnB1dEVsLnZhbGlkYXRpb25NZXNzYWdlLCBjb25maWcpO1xuICB9IGVsc2Uge1xuICAgIGhpZGVJbnB1dEVycm9yKGZvcm1FbCwgaW5wdXRFbCwgY29uZmlnKTtcbiAgfVxufTtcblxuY29uc3QgaGFzSW52YWxpZElucHV0ID0gKGlucHV0TGlzdCkgPT4ge1xuICByZXR1cm4gaW5wdXRMaXN0LnNvbWUoKGlucHV0KSA9PiB7XG4gICAgcmV0dXJuICFpbnB1dC52YWxpZGl0eS52YWxpZDtcbiAgfSk7XG59O1xuXG5jb25zdCB0b2dnbGVCdXR0b25TdGF0ZSA9IChpbnB1dExpc3QsIGJ1dHRvbkVsLCBjb25maWcpID0+IHtcbiAgaWYgKGhhc0ludmFsaWRJbnB1dChpbnB1dExpc3QpKSB7XG4gICAgZGlzYWJsZWRCdXR0b24oYnV0dG9uRWwsIGNvbmZpZyk7XG4gIH0gZWxzZSB7XG4gICAgYnV0dG9uRWwuZGlzYWJsZWQgPSBmYWxzZTtcbiAgICBidXR0b25FbC5jbGFzc0xpc3QucmVtb3ZlKGNvbmZpZy5pbmFjdGl2ZUJ1dHRvbkNsYXNzKTtcbiAgfVxufTtcblxuZXhwb3J0IGNvbnN0IGRpc2FibGVkQnV0dG9uID0gKGJ1dHRvbkVsLCBjb25maWcpID0+IHtcbiAgYnV0dG9uRWwuZGlzYWJsZWQgPSB0cnVlO1xuICBidXR0b25FbC5jbGFzc0xpc3QuYWRkKGNvbmZpZy5pbmFjdGl2ZUJ1dHRvbkNsYXNzKTtcbn07XG5cbmV4cG9ydCBjb25zdCByZXNldFZhbGlkYXRpb24gPSAoZm9ybUVsLCBpbnB1dExpc3QsIGNvbmZpZykgPT4ge1xuICBpbnB1dExpc3QuZm9yRWFjaCgoaW5wdXQpID0+IHtcbiAgICBoaWRlSW5wdXRFcnJvcihmb3JtRWwsIGlucHV0LCBjb25maWcpO1xuICB9KTtcbn07XG5cbmNvbnN0IHNldEV2ZW50TGlzdGVuZXJzID0gKGZvcm1FbCwgY29uZmlnKSA9PiB7XG4gIGNvbnN0IGlucHV0TGlzdCA9IEFycmF5LmZyb20oZm9ybUVsLnF1ZXJ5U2VsZWN0b3JBbGwoY29uZmlnLmlucHV0U2VsZWN0b3IpKTtcbiAgY29uc3QgYnV0dG9uRWxlbWVudCA9IGZvcm1FbC5xdWVyeVNlbGVjdG9yKGNvbmZpZy5zdWJtaXRCdXR0b25TZWxlY3Rvcik7XG5cbiAgdG9nZ2xlQnV0dG9uU3RhdGUoaW5wdXRMaXN0LCBidXR0b25FbGVtZW50LCBjb25maWcpO1xuXG4gIGlucHV0TGlzdC5mb3JFYWNoKChpbnB1dEVsZW1lbnQpID0+IHtcbiAgICBpbnB1dEVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcImlucHV0XCIsIGZ1bmN0aW9uICgpIHtcbiAgICAgIGNoZWNrSW5wdXRWYWxpZGl0eShmb3JtRWwsIGlucHV0RWxlbWVudCwgY29uZmlnKTtcbiAgICAgIHRvZ2dsZUJ1dHRvblN0YXRlKGlucHV0TGlzdCwgYnV0dG9uRWxlbWVudCwgY29uZmlnKTtcbiAgICB9KTtcbiAgfSk7XG59O1xuXG5leHBvcnQgY29uc3QgZW5hYmxlVmFsaWRhdGlvbiA9IChjb25maWcpID0+IHtcbiAgY29uc3QgZm9ybUxpc3QgPSBBcnJheS5mcm9tKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoY29uZmlnLmZvcm1TZWxlY3RvcikpO1xuICBmb3JtTGlzdC5mb3JFYWNoKChmb3JtRWxlbWVudCkgPT4ge1xuICAgIHNldEV2ZW50TGlzdGVuZXJzKGZvcm1FbGVtZW50LCBjb25maWcpO1xuICB9KTtcbn07XG4iLCJleHBvcnQgZnVuY3Rpb24gc2V0QnV0dG9uVGV4dChcbiAgYnRuLFxuICBpc0xvYWRpbmcsXG4gIGxvYWRpbmdUZXh0ID0gXCJTYXZpbmcuLi5cIixcbiAgZGVmYXVsdFRleHQgPSBcIlNhdmVcIlxuKSB7XG4gIGlmIChpc0xvYWRpbmcpIHtcbiAgICBidG4udGV4dENvbnRlbnQgPSBsb2FkaW5nVGV4dDtcbiAgICBidG4uZGlzYWJsZWQgPSB0cnVlO1xuICB9IGVsc2Uge1xuICAgIGJ0bi50ZXh0Q29udGVudCA9IGRlZmF1bHRUZXh0O1xuICAgIGJ0bi5kaXNhYmxlZCA9IGZhbHNlO1xuICB9XG59XG5cbmV4cG9ydCBmdW5jdGlvbiByZW5kZXJMb2FkaW5nKGlzTG9hZGluZywgYnRuLCBsb2FkaW5nVGV4dCwgZGVmYXVsdFRleHQpIHtcbiAgc2V0QnV0dG9uVGV4dChidG4sIGlzTG9hZGluZywgbG9hZGluZ1RleHQsIGRlZmF1bHRUZXh0KTtcbn1cbiIsImltcG9ydCBcIi4vaW5kZXguY3NzXCI7XG5pbXBvcnQge1xuICBlbmFibGVWYWxpZGF0aW9uLFxuICBzZXR0aW5ncyxcbiAgZGlzYWJsZWRCdXR0b24sXG4gIHJlc2V0VmFsaWRhdGlvbixcbn0gZnJvbSBcIi4uL3NjcmlwdHMvdmFsaWRhdGlvbi5qc1wiO1xuaW1wb3J0IHsgcmVuZGVyTG9hZGluZyB9IGZyb20gXCIuLi91dGlscy9oZWxwZXJzLmpzXCI7XG5pbXBvcnQgQXBpIGZyb20gXCIuLi91dGlscy9BcGkuanNcIjtcblxuLy8gY29uc3QgaW5pdGlhbENhcmRzID0gW1xuLy8gICB7XG4vLyAgICAgbmFtZTogXCJHb2xkZW4gR2F0ZSBCcmlkZ2VcIixcbi8vICAgICBsaW5rOiBcImh0dHBzOi8vcHJhY3RpY3VtLWNvbnRlbnQuczMudXMtd2VzdC0xLmFtYXpvbmF3cy5jb20vc29mdHdhcmUtZW5naW5lZXIvc3BvdHMvNy1waG90by1ieS1ncmlmZmluLXdvb2xkcmlkZ2UtZnJvbS1wZXhlbHMuanBnXCIsXG4vLyAgIH0sXG4vLyAgIHtcbi8vICAgICBuYW1lOiBcIlZhbCBUaG9yZW5zXCIsXG4vLyAgICAgbGluazogXCJodHRwczovL3ByYWN0aWN1bS1jb250ZW50LnMzLnVzLXdlc3QtMS5hbWF6b25hd3MuY29tL3NvZnR3YXJlLWVuZ2luZWVyL3Nwb3RzLzEtcGhvdG8tYnktbW9yaXR6LWZlbGRtYW5uLWZyb20tcGV4ZWxzLmpwZ1wiLFxuLy8gICB9LFxuLy8gICB7XG4vLyAgICAgbmFtZTogXCJSZXN0YXVyYW50IHRlcnJhY2VcIixcbi8vICAgICBsaW5rOiBcImh0dHBzOi8vcHJhY3RpY3VtLWNvbnRlbnQuczMudXMtd2VzdC0xLmFtYXpvbmF3cy5jb20vc29mdHdhcmUtZW5naW5lZXIvc3BvdHMvMi1waG90by1ieS1jZWlsaW5lLWZyb20tcGV4ZWxzLmpwZ1wiLFxuLy8gICB9LFxuLy8gICB7XG4vLyAgICAgbmFtZTogXCJBbiBvdXRkb29yIGNhZmVcIixcbi8vICAgICBsaW5rOiBcImh0dHBzOi8vcHJhY3RpY3VtLWNvbnRlbnQuczMudXMtd2VzdC0xLmFtYXpvbmF3cy5jb20vc29mdHdhcmUtZW5naW5lZXIvc3BvdHMvMy1waG90by1ieS10dWJhbnVyLWRvZ2FuLWZyb20tcGV4ZWxzLmpwZ1wiLFxuLy8gICB9LFxuLy8gICB7XG4vLyAgICAgbmFtZTogXCJBIHZlcnkgbG9uZyBicmlkZ2UsIG92ZXIgdGhlIGZvcmVzdCBhbmQgdGhyb3VnaCB0aGUgdHJlZXNcIixcbi8vICAgICBsaW5rOiBcImh0dHBzOi8vcHJhY3RpY3VtLWNvbnRlbnQuczMudXMtd2VzdC0xLmFtYXpvbmF3cy5jb20vc29mdHdhcmUtZW5naW5lZXIvc3BvdHMvNC1waG90by1ieS1tYXVyaWNlLWxhc2NoZXQtZnJvbS1wZXhlbHMuanBnXCIsXG4vLyAgIH0sXG4vLyAgIHtcbi8vICAgICBuYW1lOiBcIlR1bm5lbCB3aXRoIG1vcm5pbmcgbGlnaHRcIixcbi8vICAgICBsaW5rOiBcImh0dHBzOi8vcHJhY3RpY3VtLWNvbnRlbnQuczMudXMtd2VzdC0xLmFtYXpvbmF3cy5jb20vc29mdHdhcmUtZW5naW5lZXIvc3BvdHMvNS1waG90by1ieS12YW4tYW5oLW5ndXllbi1mcm9tLXBleGVscy5qcGdcIixcbi8vICAgfSxcbi8vICAge1xuLy8gICAgIG5hbWU6IFwiTW91bnRhaW4gaG91c2VcIixcbi8vICAgICBsaW5rOiBcImh0dHBzOi8vcHJhY3RpY3VtLWNvbnRlbnQuczMudXMtd2VzdC0xLmFtYXpvbmF3cy5jb20vc29mdHdhcmUtZW5naW5lZXIvc3BvdHMvNi1waG90by1ieS1tb3JpdHotZmVsZG1hbm4tZnJvbS1wZXhlbHMuanBnXCIsXG4vLyAgIH0sXG4vLyBdO1xuXG5jb25zdCBhcGkgPSBuZXcgQXBpKHtcbiAgYmFzZVVybDogXCJodHRwczovL2Fyb3VuZC1hcGkuZW4udHJpcGxldGVuLXNlcnZpY2VzLmNvbS92MVwiLFxuICBoZWFkZXJzOiB7XG4gICAgYXV0aG9yaXphdGlvbjogXCI3OTZhM2Q5OC1lY2UyLTQ0NGItOWFjNS0zMGE1NjRlMzUxMjJcIixcbiAgICBcIkNvbnRlbnQtVHlwZVwiOiBcImFwcGxpY2F0aW9uL2pzb25cIixcbiAgfSxcbn0pO1xuXG5sZXQgdXNlcklkO1xuXG5jb25zdCBwcm9maWxlQXZhdGFyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wcm9maWxlX19pbWFnZVwiKTtcblxuYXBpXG4gIC5nZXRBcHBJbmZvKClcbiAgLnRoZW4oKFt1c2VyRGF0YSwgY2FyZHNdKSA9PiB7XG4gICAgdXNlcklkID0gdXNlckRhdGEuX2lkOyAvL1xuICAgIHByb2ZpbGVUaXRsZS50ZXh0Q29udGVudCA9IHVzZXJEYXRhLm5hbWU7XG4gICAgcHJvZmlsZVRleHQudGV4dENvbnRlbnQgPSB1c2VyRGF0YS5hYm91dDtcbiAgICBwcm9maWxlQXZhdGFyLnNyYyA9IHVzZXJEYXRhLmF2YXRhcjtcblxuICAgIGNhcmRzLmZvckVhY2goKGVsZW1lbnQpID0+IHtcbiAgICAgIGNvbnN0IGNhcmRFbGVtZW50ID0gZ2V0Q2FyZEVsZW1lbnQoZWxlbWVudCk7XG4gICAgICBjYXJkc0xpc3QuYXBwZW5kKGNhcmRFbGVtZW50KTtcbiAgICB9KTtcbiAgfSlcbiAgLmNhdGNoKGNvbnNvbGUuZXJyb3IpO1xuXG5jb25zdCBlZGl0UHJvZmlsZUJ1dHRvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucHJvZmlsZV9fZWRpdFwiKTtcbmNvbnN0IGVkaXRQcm9maWxlTW9kYWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI2VkaXQtcHJvZmlsZS1tb2RhbFwiKTtcbmNvbnN0IGVkaXRQcm9maWxlU3VibWl0QnV0dG9uID0gZWRpdFByb2ZpbGVNb2RhbC5xdWVyeVNlbGVjdG9yKFxuICBcIi5tb2RhbF9fc3VibWl0LWJ1dHRvblwiXG4pO1xuY29uc3QgZWRpdFByb2ZpbGVDbG9zZUJ1dHRvbiA9IGVkaXRQcm9maWxlTW9kYWwucXVlcnlTZWxlY3RvcihcbiAgXCIubW9kYWxfX2Nsb3NlLWJ1dHRvblwiXG4pO1xuXG5jb25zdCBuZXdQb3N0QnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wcm9maWxlX19idXR0b25cIik7XG5jb25zdCBuZXdQb3N0TW9kYWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI25ldy1wb3N0LW1vZGFsXCIpO1xuY29uc3QgbmV3UG9zdFN1Ym1pdEJ1dHRvbiA9IG5ld1Bvc3RNb2RhbC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19zdWJtaXQtYnV0dG9uXCIpO1xuY29uc3QgbmV3UG9zdENsb3NlQnV0dG9uID0gbmV3UG9zdE1vZGFsLnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX2Nsb3NlLWJ1dHRvblwiKTtcblxuY29uc3QgZGVsZXRlTW9kYWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI2RlbGV0ZS1tb2RhbFwiKTtcbmNvbnN0IGRlbGV0ZUZvcm0gPSBkZWxldGVNb2RhbC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19mb3JtXCIpO1xuY29uc3QgZGVsZXRlU3VibWl0QnV0dG9uID0gZGVsZXRlRm9ybS5xdWVyeVNlbGVjdG9yKCdidXR0b25bdHlwZT1cInN1Ym1pdFwiXScpO1xuY29uc3QgZGVsZXRlQ2FuY2VsQnV0dG9uID0gZGVsZXRlRm9ybS5xdWVyeVNlbGVjdG9yKCdidXR0b25bdHlwZT1cImJ1dHRvblwiXScpO1xuY29uc3QgZGVsZXRlQ2xvc2VCdXR0b24gPSBkZWxldGVNb2RhbC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19jbG9zZS1kZWxldGVcIik7XG5cbmNvbnN0IGF2YXRhck1vZGFsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNhdmF0YXItbW9kYWxcIik7XG5jb25zdCBhdmF0YXJGb3JtID0gYXZhdGFyTW9kYWwucXVlcnlTZWxlY3RvcihcIiNlZGl0LWF2YXRhci1mb3JtXCIpO1xuY29uc3QgYXZhdGFyU3VibWl0QnV0dG9uID0gYXZhdGFyTW9kYWwucXVlcnlTZWxlY3RvcihcIi5tb2RhbF9fc3VibWl0LWJ1dHRvblwiKTtcbmNvbnN0IGF2YXRhck1vZGFsQ2xvc2VCdXR0b24gPSBhdmF0YXJNb2RhbC5xdWVyeVNlbGVjdG9yKFxuICBcIi5tb2RhbF9fY2xvc2UtYnV0dG9uXCJcbik7XG5jb25zdCBhdmF0YXJJbnB1dCA9IGF2YXRhck1vZGFsLnF1ZXJ5U2VsZWN0b3IoXCIjcHJvZmlsZS1hdmF0YXItaW5wdXRcIik7XG5jb25zdCBhdmF0YXJNb2RhbEJ1dHRvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucHJvZmlsZV9fYXZhdGFyLWJ0blwiKTtcblxuY29uc3QgcHJvZmlsZVRpdGxlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wcm9maWxlX190aXRsZVwiKTtcbmNvbnN0IHByb2ZpbGVUZXh0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wcm9maWxlX190ZXh0XCIpO1xuY29uc3QgcHJvZmlsZU5hbWVJbnB1dCA9IGVkaXRQcm9maWxlTW9kYWwucXVlcnlTZWxlY3RvcihcIiNwcm9maWxlLW5hbWUtaW5wdXRcIik7XG5jb25zdCBkZXNjcmlwdGlvbklucHV0ID0gZWRpdFByb2ZpbGVNb2RhbC5xdWVyeVNlbGVjdG9yKFxuICBcIiNwcm9maWxlLWRlc2NyaXB0aW9uLWlucHV0XCJcbik7XG5cbmNvbnN0IGNhcmRDYXB0aW9uSW5wdXQgPSBuZXdQb3N0TW9kYWwucXVlcnlTZWxlY3RvcihcIiNjYXJkLWNhcHRpb24taW5wdXRcIik7XG5jb25zdCBsaW5rSW5wdXQgPSBuZXdQb3N0TW9kYWwucXVlcnlTZWxlY3RvcihcIiNjYXJkLWltYWdlLWlucHV0XCIpO1xuXG5jb25zdCBhZGRDYXJkRm9ybUVsZW1lbnQgPSBuZXdQb3N0TW9kYWwucXVlcnlTZWxlY3RvcihcIiNuZXdwb3N0LWZvcm1cIik7XG5cbmNvbnN0IHByb2ZpbGVGb3JtRWxlbWVudCA9IGVkaXRQcm9maWxlTW9kYWwucXVlcnlTZWxlY3RvcihcIiNlZGl0LWZvcm1cIik7XG5cbmNvbnN0IHByZXZpZXdNb2RhbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjcHJldmlldy1tb2RhbFwiKTtcbmNvbnN0IHByZXZpZXdNb2RhbENsb3NlQnV0dG9uID0gcHJldmlld01vZGFsLnF1ZXJ5U2VsZWN0b3IoXG4gIFwiLm1vZGFsX19jbG9zZS1pbWFnZVwiXG4pO1xuY29uc3QgcHJldmlld0ltYWdlID0gcHJldmlld01vZGFsLnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX2ltYWdlXCIpO1xuXG5jb25zdCBwcmV2aWV3VGl0bGUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX190ZXh0XCIpO1xuXG5jb25zdCBjYXJkVGVtcGxhdGUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI2NhcmRzLXRlbXBsYXRlXCIpO1xuY29uc3QgY2FyZHNMaXN0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5jYXJkc19fbGlzdFwiKTtcblxuZnVuY3Rpb24gaGFuZGxlRGVsZXRlU3VibWl0KGV2dCkge1xuICBldnQucHJldmVudERlZmF1bHQoKTtcblxuICByZW5kZXJMb2FkaW5nKHRydWUsIGRlbGV0ZVN1Ym1pdEJ1dHRvbiwgXCJEZWxldGluZy4uLlwiLCBcIkRlbGV0ZVwiKTtcbiAgYXBpXG4gICAgLmRlbGV0ZUNhcmQoc2VsZWN0ZWRDYXJkSUQpXG4gICAgLnRoZW4oKCkgPT4ge1xuICAgICAgc2VsZWN0ZWRDYXJkLnJlbW92ZSgpO1xuICAgICAgY2xvc2VNb2RhbChkZWxldGVNb2RhbCk7XG4gICAgfSlcbiAgICAuY2F0Y2goY29uc29sZS5lcnJvcilcbiAgICAuZmluYWxseSgoKSA9PiB7XG4gICAgICByZW5kZXJMb2FkaW5nKGZhbHNlLCBkZWxldGVTdWJtaXRCdXR0b24sIFwiRGVsZXRpbmcuLi5cIiwgXCJEZWxldGVcIik7XG4gICAgfSk7XG59XG5cbmZ1bmN0aW9uIGhhbmRsZURlbGV0ZUNhcmQoY2FyZEVsZW1lbnQsIGNhcmRJZCkge1xuICBzZWxlY3RlZENhcmQgPSBjYXJkRWxlbWVudDtcbiAgc2VsZWN0ZWRDYXJkSUQgPSBjYXJkSWQ7XG4gIG9wZW5Nb2RhbChkZWxldGVNb2RhbCk7XG59XG5cbmZ1bmN0aW9uIGhhbmRsZUxpa2UoZXZ0LCBpZCkge1xuICBjb25zdCBsaWtlQnV0dG9uID0gZXZ0LnRhcmdldDtcbiAgY29uc3QgaXNMaWtlZCA9IGxpa2VCdXR0b24uY2xhc3NMaXN0LmNvbnRhaW5zKFwiY2FyZF9fYnV0dG9uX2FjdGl2ZVwiKTtcblxuICBhcGlcbiAgICAuY2hhbmdlTGlrZShpZCwgaXNMaWtlZClcbiAgICAudGhlbigodXBkYXRlZENhcmQpID0+IHtcbiAgICAgIGlmICh1cGRhdGVkQ2FyZC5pc0xpa2VkKSB7XG4gICAgICAgIGxpa2VCdXR0b24uY2xhc3NMaXN0LmFkZChcImNhcmRfX2J1dHRvbl9hY3RpdmVcIik7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBsaWtlQnV0dG9uLmNsYXNzTGlzdC5yZW1vdmUoXCJjYXJkX19idXR0b25fYWN0aXZlXCIpO1xuICAgICAgfVxuICAgIH0pXG4gICAgLmNhdGNoKGNvbnNvbGUuZXJyb3IpO1xufVxuXG5sZXQgc2VsZWN0ZWRDYXJkO1xubGV0IHNlbGVjdGVkQ2FyZElEO1xuXG5mdW5jdGlvbiBnZXRDYXJkRWxlbWVudChkYXRhKSB7XG4gIGNvbnN0IGNhcmRFbGVtZW50ID0gY2FyZFRlbXBsYXRlLmNvbnRlbnRcbiAgICAucXVlcnlTZWxlY3RvcihcIi5jYXJkXCIpXG4gICAgLmNsb25lTm9kZSh0cnVlKTtcbiAgY29uc3QgY2FyZFRpdGxlRWxlbWVudCA9IGNhcmRFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZF9fdGV4dFwiKTtcbiAgY29uc3QgY2FyZEltYWdlRWxlbWVudCA9IGNhcmRFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZF9faW1hZ2VcIik7XG5cbiAgY2FyZEltYWdlRWxlbWVudC5zcmMgPSBkYXRhLmxpbms7XG4gIGNhcmRJbWFnZUVsZW1lbnQuYWx0ID0gZGF0YS5uYW1lO1xuICBjYXJkVGl0bGVFbGVtZW50LnRleHRDb250ZW50ID0gZGF0YS5uYW1lO1xuXG4gIGNvbnN0IGNhcmRMaWtlQnV0dG9uID0gY2FyZEVsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5jYXJkX19idXR0b25cIik7XG4gIGlmIChkYXRhLmlzTGlrZWQpIHtcbiAgICBjYXJkTGlrZUJ1dHRvbi5jbGFzc0xpc3QuYWRkKFwiY2FyZF9fYnV0dG9uX2FjdGl2ZVwiKTtcbiAgfVxuXG4gIGNhcmRMaWtlQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoZXZ0KSA9PiBoYW5kbGVMaWtlKGV2dCwgZGF0YS5faWQpKTtcblxuICBjb25zdCBjYXJkVHJhc2hCdXR0b24gPSBjYXJkRWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLmNhcmRfX3RyYXNoLWJ1dHRvblwiKTtcbiAgY2FyZFRyYXNoQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PlxuICAgIGhhbmRsZURlbGV0ZUNhcmQoY2FyZEVsZW1lbnQsIGRhdGEuX2lkKVxuICApO1xuXG4gIGNhcmRJbWFnZUVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgICBwcmV2aWV3SW1hZ2Uuc3JjID0gZGF0YS5saW5rO1xuICAgIHByZXZpZXdJbWFnZS5hbHQgPSBkYXRhLm5hbWU7XG4gICAgcHJldmlld1RpdGxlLnRleHRDb250ZW50ID0gZGF0YS5uYW1lO1xuICAgIG9wZW5Nb2RhbChwcmV2aWV3TW9kYWwpO1xuICB9KTtcblxuICByZXR1cm4gY2FyZEVsZW1lbnQ7XG59XG5cbmZ1bmN0aW9uIG9wZW5Nb2RhbChtb2RhbCkge1xuICBtb2RhbC5jbGFzc0xpc3QuYWRkKFwibW9kYWxfaXMtb3BlbmVkXCIpO1xuXG4gIG1vZGFsLmFkZEV2ZW50TGlzdGVuZXIoXCJtb3VzZWRvd25cIiwgY2xvc2VPbk92ZXJsYXkpO1xuICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKFwia2V5ZG93blwiLCBjbG9zZU9uRXNjYXBlKTtcbn1cblxuZnVuY3Rpb24gY2xvc2VNb2RhbChtb2RhbCkge1xuICBtb2RhbC5jbGFzc0xpc3QucmVtb3ZlKFwibW9kYWxfaXMtb3BlbmVkXCIpO1xuXG4gIG1vZGFsLnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJtb3VzZWRvd25cIiwgY2xvc2VPbk92ZXJsYXkpO1xuICBkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKFwia2V5ZG93blwiLCBjbG9zZU9uRXNjYXBlKTtcbn1cblxuZnVuY3Rpb24gY2xvc2VPbk92ZXJsYXkoZXZ0KSB7XG4gIGlmIChldnQudGFyZ2V0ID09PSBldnQuY3VycmVudFRhcmdldCkge1xuICAgIGNsb3NlTW9kYWwoZXZ0LmN1cnJlbnRUYXJnZXQpO1xuICB9XG59XG5cbmZ1bmN0aW9uIGNsb3NlT25Fc2NhcGUoZXZ0KSB7XG4gIGlmIChldnQua2V5ID09PSBcIkVzY2FwZVwiKSB7XG4gICAgY29uc3Qgb3BlbmVkTW9kYWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX2lzLW9wZW5lZFwiKTtcbiAgICBpZiAob3BlbmVkTW9kYWwpIHtcbiAgICAgIGNsb3NlTW9kYWwob3BlbmVkTW9kYWwpO1xuICAgIH1cbiAgfVxufVxuXG5mdW5jdGlvbiBoYW5kbGVQcm9maWxlRm9ybVN1Ym1pdChldnQpIHtcbiAgZXZ0LnByZXZlbnREZWZhdWx0KCk7XG5cbiAgcmVuZGVyTG9hZGluZyh0cnVlLCBlZGl0UHJvZmlsZVN1Ym1pdEJ1dHRvbik7XG5cbiAgYXBpXG4gICAgLmVkaXRVc2VySW5mbyh7XG4gICAgICBuYW1lOiBwcm9maWxlTmFtZUlucHV0LnZhbHVlLFxuICAgICAgYWJvdXQ6IGRlc2NyaXB0aW9uSW5wdXQudmFsdWUsXG4gICAgfSlcbiAgICAudGhlbigodXBkYXRlZFVzZXIpID0+IHtcbiAgICAgIHByb2ZpbGVUaXRsZS50ZXh0Q29udGVudCA9IHVwZGF0ZWRVc2VyLm5hbWU7XG4gICAgICBwcm9maWxlVGV4dC50ZXh0Q29udGVudCA9IHVwZGF0ZWRVc2VyLmFib3V0O1xuICAgICAgY2xvc2VNb2RhbChlZGl0UHJvZmlsZU1vZGFsKTtcblxuICAgICAgZXZ0LnRhcmdldC5yZXNldCgpO1xuICAgICAgZGlzYWJsZWRCdXR0b24oZWRpdFByb2ZpbGVTdWJtaXRCdXR0b24sIHNldHRpbmdzKTtcbiAgICB9KVxuICAgIC5jYXRjaChjb25zb2xlLmVycm9yKVxuICAgIC5maW5hbGx5KCgpID0+IHtcbiAgICAgIHJlbmRlckxvYWRpbmcoZmFsc2UsIGVkaXRQcm9maWxlU3VibWl0QnV0dG9uKTtcbiAgICB9KTtcbn1cblxuZnVuY3Rpb24gaGFuZGxlQXZhdGFyRm9ybVN1Ym1pdChldnQpIHtcbiAgZXZ0LnByZXZlbnREZWZhdWx0KCk7XG5cbiAgcmVuZGVyTG9hZGluZyh0cnVlLCBhdmF0YXJTdWJtaXRCdXR0b24pO1xuXG4gIGFwaVxuICAgIC5lZGl0QXZhdGFySW5mbyhhdmF0YXJJbnB1dC52YWx1ZSlcbiAgICAudGhlbigodXBkYXRlZFVzZXIpID0+IHtcbiAgICAgIHByb2ZpbGVBdmF0YXIuc3JjID0gdXBkYXRlZFVzZXIuYXZhdGFyO1xuICAgICAgY2xvc2VNb2RhbChhdmF0YXJNb2RhbCk7XG5cbiAgICAgIGV2dC50YXJnZXQucmVzZXQoKTtcbiAgICAgIGRpc2FibGVkQnV0dG9uKGF2YXRhclN1Ym1pdEJ1dHRvbiwgc2V0dGluZ3MpO1xuICAgIH0pXG4gICAgLmNhdGNoKGNvbnNvbGUuZXJyb3IpXG4gICAgLmZpbmFsbHkoKCkgPT4ge1xuICAgICAgcmVuZGVyTG9hZGluZyhmYWxzZSwgYXZhdGFyU3VibWl0QnV0dG9uKTtcbiAgICB9KTtcbn1cblxucHJvZmlsZUZvcm1FbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJzdWJtaXRcIiwgaGFuZGxlUHJvZmlsZUZvcm1TdWJtaXQpO1xuXG5mdW5jdGlvbiBoYW5kbGVBZGRDYXJkU3VibWl0KGV2dCkge1xuICBldnQucHJldmVudERlZmF1bHQoKTtcblxuICByZW5kZXJMb2FkaW5nKHRydWUsIG5ld1Bvc3RTdWJtaXRCdXR0b24pO1xuXG4gIGFwaVxuICAgIC5hZGRDYXJkKHtcbiAgICAgIG5hbWU6IGNhcmRDYXB0aW9uSW5wdXQudmFsdWUsXG4gICAgICBsaW5rOiBsaW5rSW5wdXQudmFsdWUsXG4gICAgfSlcbiAgICAudGhlbigobmV3Q2FyZCkgPT4ge1xuICAgICAgY29uc3QgY2FyZEVsZW1lbnQgPSBnZXRDYXJkRWxlbWVudChuZXdDYXJkKTtcbiAgICAgIGNhcmRzTGlzdC5wcmVwZW5kKGNhcmRFbGVtZW50KTtcbiAgICAgIGNsb3NlTW9kYWwobmV3UG9zdE1vZGFsKTtcbiAgICAgIGV2dC50YXJnZXQucmVzZXQoKTtcbiAgICAgIGRpc2FibGVkQnV0dG9uKG5ld1Bvc3RTdWJtaXRCdXR0b24sIHNldHRpbmdzKTtcbiAgICB9KVxuICAgIC5jYXRjaChjb25zb2xlLmVycm9yKVxuICAgIC5maW5hbGx5KCgpID0+IHtcbiAgICAgIHJlbmRlckxvYWRpbmcoZmFsc2UsIG5ld1Bvc3RTdWJtaXRCdXR0b24pO1xuICAgIH0pO1xufVxuXG5hZGRDYXJkRm9ybUVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcInN1Ym1pdFwiLCBoYW5kbGVBZGRDYXJkU3VibWl0KTtcblxuYXZhdGFyRm9ybS5hZGRFdmVudExpc3RlbmVyKFwic3VibWl0XCIsIGhhbmRsZUF2YXRhckZvcm1TdWJtaXQpO1xuXG5kZWxldGVGb3JtLmFkZEV2ZW50TGlzdGVuZXIoXCJzdWJtaXRcIiwgaGFuZGxlRGVsZXRlU3VibWl0KTtcblxuZGVsZXRlQ2FuY2VsQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBmdW5jdGlvbiAoKSB7XG4gIGNsb3NlTW9kYWwoZGVsZXRlTW9kYWwpO1xufSk7XG5cbmVkaXRQcm9maWxlQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBmdW5jdGlvbiAoKSB7XG4gIG9wZW5Nb2RhbChlZGl0UHJvZmlsZU1vZGFsKTtcblxuICBwcm9maWxlTmFtZUlucHV0LnZhbHVlID0gcHJvZmlsZVRpdGxlLnRleHRDb250ZW50O1xuICBkZXNjcmlwdGlvbklucHV0LnZhbHVlID0gcHJvZmlsZVRleHQudGV4dENvbnRlbnQ7XG5cbiAgcmVzZXRWYWxpZGF0aW9uKFxuICAgIHByb2ZpbGVGb3JtRWxlbWVudCxcbiAgICBbcHJvZmlsZU5hbWVJbnB1dCwgZGVzY3JpcHRpb25JbnB1dF0sXG4gICAgc2V0dGluZ3NcbiAgKTtcbn0pO1xuXG5kZWxldGVDbG9zZUJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgZnVuY3Rpb24gKCkge1xuICBjbG9zZU1vZGFsKGRlbGV0ZU1vZGFsKTtcbn0pO1xuXG5kZWxldGVDYW5jZWxCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGZ1bmN0aW9uICgpIHtcbiAgY2xvc2VNb2RhbChkZWxldGVNb2RhbCk7XG59KTtcblxuZWRpdFByb2ZpbGVDbG9zZUJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgZnVuY3Rpb24gKCkge1xuICBjbG9zZU1vZGFsKGVkaXRQcm9maWxlTW9kYWwpO1xufSk7XG5cbnByZXZpZXdNb2RhbENsb3NlQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBmdW5jdGlvbiAoKSB7XG4gIGNsb3NlTW9kYWwocHJldmlld01vZGFsKTtcbn0pO1xuXG5uZXdQb3N0QnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBmdW5jdGlvbiAoKSB7XG4gIG9wZW5Nb2RhbChuZXdQb3N0TW9kYWwpO1xufSk7XG5cbm5ld1Bvc3RDbG9zZUJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgZnVuY3Rpb24gKCkge1xuICBjbG9zZU1vZGFsKG5ld1Bvc3RNb2RhbCk7XG59KTtcblxuYXZhdGFyTW9kYWxCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgb3Blbk1vZGFsKGF2YXRhck1vZGFsKTtcbn0pO1xuXG5hdmF0YXJNb2RhbENsb3NlQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBmdW5jdGlvbiAoKSB7XG4gIGNsb3NlTW9kYWwoYXZhdGFyTW9kYWwpO1xufSk7XG5cbmVuYWJsZVZhbGlkYXRpb24oc2V0dGluZ3MpO1xuIiwiY2xhc3MgQXBpIHtcbiAgY29uc3RydWN0b3IoeyBiYXNlVXJsLCBoZWFkZXJzIH0pIHtcbiAgICB0aGlzLl9iYXNlVXJsID0gYmFzZVVybDtcbiAgICB0aGlzLl9oZWFkZXJzID0gaGVhZGVycztcbiAgfVxuXG4gIF9oYW5kbGVTZXJ2ZXJSZXNwb25zZShyZXMpIHtcbiAgICBpZiAocmVzLm9rKSB7XG4gICAgICByZXR1cm4gcmVzLmpzb24oKTtcbiAgICB9XG4gICAgcmV0dXJuIFByb21pc2UucmVqZWN0KGBFcnJvcjogJHtyZXMuc3RhdHVzfWApO1xuICB9XG5cbiAgZ2V0SW5pdGlhbENhcmRzKCkge1xuICAgIHJldHVybiBmZXRjaChgJHt0aGlzLl9iYXNlVXJsfS9jYXJkc2AsIHtcbiAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMsXG4gICAgfSkudGhlbih0aGlzLl9oYW5kbGVTZXJ2ZXJSZXNwb25zZSk7XG4gIH1cblxuICBnZXRBcHBJbmZvKCkge1xuICAgIHJldHVybiBQcm9taXNlLmFsbChbdGhpcy5nZXRVc2VySW5mbygpLCB0aGlzLmdldEluaXRpYWxDYXJkcygpXSk7XG4gIH1cblxuICBnZXRVc2VySW5mbygpIHtcbiAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vdXNlcnMvbWVgLCB7IGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMgfSkudGhlbihcbiAgICAgIHRoaXMuX2hhbmRsZVNlcnZlclJlc3BvbnNlXG4gICAgKTtcbiAgfVxuXG4gIGVkaXRVc2VySW5mbyh7IG5hbWUsIGFib3V0IH0pIHtcbiAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vdXNlcnMvbWVgLCB7XG4gICAgICBtZXRob2Q6IFwiUEFUQ0hcIixcbiAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMsXG4gICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgIG5hbWUsXG4gICAgICAgIGFib3V0LFxuICAgICAgfSksXG4gICAgfSkudGhlbih0aGlzLl9oYW5kbGVTZXJ2ZXJSZXNwb25zZSk7XG4gIH1cblxuICBlZGl0QXZhdGFySW5mbyhhdmF0YXIpIHtcbiAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vdXNlcnMvbWUvYXZhdGFyYCwge1xuICAgICAgbWV0aG9kOiBcIlBBVENIXCIsXG4gICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxuICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoe1xuICAgICAgICBhdmF0YXIsXG4gICAgICB9KSxcbiAgICB9KS50aGVuKHRoaXMuX2hhbmRsZVNlcnZlclJlc3BvbnNlKTtcbiAgfVxuXG4gIGFkZENhcmQoeyBuYW1lLCBsaW5rIH0pIHtcbiAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vY2FyZHNgLCB7XG4gICAgICBtZXRob2Q6IFwiUE9TVFwiLFxuICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcbiAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHsgbmFtZSwgbGluayB9KSxcbiAgICB9KS50aGVuKHRoaXMuX2hhbmRsZVNlcnZlclJlc3BvbnNlKTtcbiAgfVxuXG4gIGRlbGV0ZUNhcmQoaWQpIHtcbiAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vY2FyZHMvJHtpZH1gLCB7XG4gICAgICBtZXRob2Q6IFwiREVMRVRFXCIsXG4gICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxuICAgIH0pLnRoZW4odGhpcy5faGFuZGxlU2VydmVyUmVzcG9uc2UpO1xuICB9XG5cbiAgY2hhbmdlTGlrZShpZCwgaXNMaWtlZCkge1xuICAgIHJldHVybiBmZXRjaChgJHt0aGlzLl9iYXNlVXJsfS9jYXJkcy8ke2lkfS9saWtlc2AsIHtcbiAgICAgIG1ldGhvZDogaXNMaWtlZCA/IFwiREVMRVRFXCIgOiBcIlBVVFwiLFxuICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcbiAgICB9KS50aGVuKHRoaXMuX2hhbmRsZVNlcnZlclJlc3BvbnNlKTtcbiAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCBBcGk7XG4iXSwibmFtZXMiOlsic2V0dGluZ3MiLCJmb3JtU2VsZWN0b3IiLCJpbnB1dFNlbGVjdG9yIiwic3VibWl0QnV0dG9uU2VsZWN0b3IiLCJpbmFjdGl2ZUJ1dHRvbkNsYXNzIiwiaW5wdXRFcnJvckNsYXNzIiwiZXJyb3JDbGFzcyIsImhpZGVJbnB1dEVycm9yIiwiZm9ybUVsIiwiaW5wdXRFbCIsImNvbmZpZyIsInF1ZXJ5U2VsZWN0b3IiLCJpZCIsInRleHRDb250ZW50IiwiY2xhc3NMaXN0IiwicmVtb3ZlIiwidG9nZ2xlQnV0dG9uU3RhdGUiLCJpbnB1dExpc3QiLCJidXR0b25FbCIsInNvbWUiLCJpbnB1dCIsInZhbGlkaXR5IiwidmFsaWQiLCJoYXNJbnZhbGlkSW5wdXQiLCJkaXNhYmxlZEJ1dHRvbiIsImRpc2FibGVkIiwiYWRkIiwicmVuZGVyTG9hZGluZyIsImlzTG9hZGluZyIsImJ0biIsImxvYWRpbmdUZXh0IiwiZGVmYXVsdFRleHQiLCJzZXRCdXR0b25UZXh0IiwiYXBpIiwiY29uc3RydWN0b3IiLCJiYXNlVXJsIiwiaGVhZGVycyIsInRoaXMiLCJfYmFzZVVybCIsIl9oZWFkZXJzIiwiX2hhbmRsZVNlcnZlclJlc3BvbnNlIiwicmVzIiwib2siLCJqc29uIiwiUHJvbWlzZSIsInJlamVjdCIsInN0YXR1cyIsImdldEluaXRpYWxDYXJkcyIsImZldGNoIiwidGhlbiIsImdldEFwcEluZm8iLCJhbGwiLCJnZXRVc2VySW5mbyIsImVkaXRVc2VySW5mbyIsIm5hbWUiLCJhYm91dCIsIm1ldGhvZCIsImJvZHkiLCJKU09OIiwic3RyaW5naWZ5IiwiZWRpdEF2YXRhckluZm8iLCJhdmF0YXIiLCJhZGRDYXJkIiwibGluayIsImRlbGV0ZUNhcmQiLCJjaGFuZ2VMaWtlIiwiaXNMaWtlZCIsImF1dGhvcml6YXRpb24iLCJ1c2VySWQiLCJwcm9maWxlQXZhdGFyIiwiZG9jdW1lbnQiLCJ1c2VyRGF0YSIsImNhcmRzIiwiX2lkIiwicHJvZmlsZVRpdGxlIiwicHJvZmlsZVRleHQiLCJzcmMiLCJmb3JFYWNoIiwiZWxlbWVudCIsImNhcmRFbGVtZW50IiwiZ2V0Q2FyZEVsZW1lbnQiLCJjYXJkc0xpc3QiLCJhcHBlbmQiLCJjYXRjaCIsImNvbnNvbGUiLCJlcnJvciIsImVkaXRQcm9maWxlQnV0dG9uIiwiZWRpdFByb2ZpbGVNb2RhbCIsImVkaXRQcm9maWxlU3VibWl0QnV0dG9uIiwiZWRpdFByb2ZpbGVDbG9zZUJ1dHRvbiIsIm5ld1Bvc3RCdXR0b24iLCJuZXdQb3N0TW9kYWwiLCJuZXdQb3N0U3VibWl0QnV0dG9uIiwibmV3UG9zdENsb3NlQnV0dG9uIiwiZGVsZXRlTW9kYWwiLCJkZWxldGVGb3JtIiwiZGVsZXRlU3VibWl0QnV0dG9uIiwiZGVsZXRlQ2FuY2VsQnV0dG9uIiwiZGVsZXRlQ2xvc2VCdXR0b24iLCJhdmF0YXJNb2RhbCIsImF2YXRhckZvcm0iLCJhdmF0YXJTdWJtaXRCdXR0b24iLCJhdmF0YXJNb2RhbENsb3NlQnV0dG9uIiwiYXZhdGFySW5wdXQiLCJhdmF0YXJNb2RhbEJ1dHRvbiIsInByb2ZpbGVOYW1lSW5wdXQiLCJkZXNjcmlwdGlvbklucHV0IiwiY2FyZENhcHRpb25JbnB1dCIsImxpbmtJbnB1dCIsImFkZENhcmRGb3JtRWxlbWVudCIsInByb2ZpbGVGb3JtRWxlbWVudCIsInByZXZpZXdNb2RhbCIsInByZXZpZXdNb2RhbENsb3NlQnV0dG9uIiwicHJldmlld0ltYWdlIiwicHJldmlld1RpdGxlIiwiY2FyZFRlbXBsYXRlIiwic2VsZWN0ZWRDYXJkIiwic2VsZWN0ZWRDYXJkSUQiLCJkYXRhIiwiY29udGVudCIsImNsb25lTm9kZSIsImNhcmRUaXRsZUVsZW1lbnQiLCJjYXJkSW1hZ2VFbGVtZW50IiwiYWx0IiwiY2FyZExpa2VCdXR0b24iLCJhZGRFdmVudExpc3RlbmVyIiwiZXZ0IiwibGlrZUJ1dHRvbiIsInRhcmdldCIsImNvbnRhaW5zIiwidXBkYXRlZENhcmQiLCJoYW5kbGVMaWtlIiwiY2FyZElkIiwib3Blbk1vZGFsIiwiaGFuZGxlRGVsZXRlQ2FyZCIsIm1vZGFsIiwiY2xvc2VPbk92ZXJsYXkiLCJjbG9zZU9uRXNjYXBlIiwiY2xvc2VNb2RhbCIsInJlbW92ZUV2ZW50TGlzdGVuZXIiLCJjdXJyZW50VGFyZ2V0Iiwia2V5Iiwib3BlbmVkTW9kYWwiLCJwcmV2ZW50RGVmYXVsdCIsInZhbHVlIiwidXBkYXRlZFVzZXIiLCJyZXNldCIsImZpbmFsbHkiLCJuZXdDYXJkIiwicHJlcGVuZCIsInJlc2V0VmFsaWRhdGlvbiIsIkFycmF5IiwiZnJvbSIsInF1ZXJ5U2VsZWN0b3JBbGwiLCJmb3JtRWxlbWVudCIsInNldEV2ZW50TGlzdGVuZXJzIiwiYnV0dG9uRWxlbWVudCIsImlucHV0RWxlbWVudCIsImNoZWNrSW5wdXRWYWxpZGl0eSIsInNob3dJbnB1dEVycm9yIiwiZXJyb3JNZXNzYWdlIiwidmFsaWRhdGlvbk1lc3NhZ2UiXSwic291cmNlUm9vdCI6IiJ9